# 7. è®ŠåŸºï¼šæ•´ç†æ­·å²çš„è—è¡“ ğŸ¨ (Rebasing)

æˆ‘å€‘å·²ç¶“å­¸æœƒäº†ä½¿ç”¨ `git merge` ä¾†æ•´åˆä¸åŒåˆ†æ”¯çš„è®Šæ›´ã€‚ç¾åœ¨ï¼Œæˆ‘å€‘ä¾†å­¸ç¿’å¦ä¸€ç¨®å¼·å¤§çš„æ•´åˆå·¥å…·ï¼š`git rebase`ã€‚`Rebase` (è®ŠåŸº) çš„ä¸»è¦ç›®çš„æ˜¯è®“æ‚¨çš„æäº¤æ­·å²ä¿æŒã€Œç·šæ€§ã€ï¼Œçœ‹èµ·ä¾†æ›´æ•´æ½”ã€æ›´æ¸…æ™°ã€‚

## `merge` vs `rebase`ï¼šå…©ç¨®å“²å­¸

å‡è¨­æ‚¨å¾ `main` åˆ†æ”¯æ‹‰å‡ºä¸€å€‹ `feature` åˆ†æ”¯ä¾†é–‹ç™¼ã€‚åœ¨é€™æ®µæ™‚é–“è£¡ï¼Œ`main` åˆ†æ”¯ä¹Ÿå¤šäº†å¹¾å€‹æ–°çš„æäº¤ã€‚

*   **`git merge` (åˆä½µ)**ï¼šåƒæ˜¯ä¸€ä½ **èª å¯¦çš„æ­·å²å­¸å®¶** ğŸ§ã€‚å®ƒæœƒå¿ å¯¦åœ°è¨˜éŒ„ä¸‹æ‰€æœ‰ç™¼ç”Ÿçš„äº‹æƒ…ï¼ŒåŒ…æ‹¬åˆ†æ”¯çš„ç”¢ç”Ÿå’Œåˆä½µã€‚é€™æœƒç”¢ç”Ÿä¸€å€‹æ–°çš„ã€Œåˆä½µæäº¤ã€ï¼Œå°‡å…©å€‹åˆ†æ”¯çš„æ­·å²äº¤ç¹”åœ¨ä¸€èµ·ã€‚æ­·å²æ˜¯å®Œå…¨çœŸå¯¦çš„ï¼Œä½†å¯èƒ½æœƒå¾ˆé›œäº‚ã€‚

    ![Merge Diagram](https://git-scm.com/images/basic-rebase-1.png)

*   **`git rebase` (è®ŠåŸº)**ï¼šåƒæ˜¯ä¸€ä½ **æ™‚é–“æ—…è¡Œçš„ç·¨è¼¯** âœï¸ã€‚å®ƒæœƒå›åˆ°éå»ï¼Œå°‡æ‚¨åœ¨ `feature` åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤ï¼Œä¸€å€‹ä¸€å€‹åœ°ã€Œé‡æ–°æ’­æ”¾ã€åˆ° `main` åˆ†æ”¯çš„æœ€æ–°æäº¤ä¹‹å¾Œã€‚å®ƒ **æ”¹å¯«äº†æäº¤æ­·å²**ï¼Œå‰µé€ äº†ä¸€å€‹å®Œç¾çš„ç·šæ€§æ•…äº‹ï¼Œå½·å½¿æ‚¨å¾ä¸€é–‹å§‹å°±æ˜¯åŸºæ–¼æœ€æ–°çš„ `main` åˆ†æ”¯é€²è¡Œé–‹ç™¼ã€‚æ­·å²æ˜¯ä¹¾æ·¨çš„ï¼Œä½†ä¸æ˜¯æœ€åˆçš„çœŸç›¸ã€‚

    ![Rebase Diagram](https://git-scm.com/images/basic-rebase-2.png)

*åœ–ç‰‡ä¾†æº: git-scm.com*

## å¦‚ä½•ä½¿ç”¨ `rebase`ï¼Ÿ

`rebase` çš„æŒ‡ä»¤å¯ä»¥ç†è§£ç‚ºï¼šã€Œæˆ‘è¦æŠŠæˆ‘ **ç›®å‰æ‰€åœ¨** çš„åˆ†æ”¯ï¼Œæ¥åˆ° **å¦ä¸€å€‹** åˆ†æ”¯çš„é ‚ç«¯ã€ã€‚

**å¸¸è¦‹æµç¨‹**ï¼š

1.  åœ¨ `feature` åˆ†æ”¯é–‹ç™¼ã€‚
2.  `main` åˆ†æ”¯æœ‰äº†æ–°çš„é€²åº¦ã€‚
3.  ç‚ºäº†è®“ `feature` åˆ†æ”¯è·Ÿä¸Š `main` çš„æœ€æ–°ç‹€æ…‹ï¼Œæ‚¨åŸ·è¡Œï¼š
    ```bash
    git switch feature
    git fetch origin # å…ˆå¾é ç«¯æŠ“å–æœ€æ–°è³‡è¨Š
    git rebase origin/main # å°‡ feature åˆ†æ”¯çš„è®Šæ›´ï¼Œé‡æ–°æ‡‰ç”¨åœ¨ main çš„æœ€æ–°ç‰ˆæœ¬ä¹‹ä¸Š
    ```
4.  ç•¶ `feature` é–‹ç™¼å®Œæˆå¾Œï¼Œåˆ‡æ›å› `main` åˆ†æ”¯ï¼Œåšä¸€æ¬¡ã€Œå¿«è½‰åˆä½µã€ã€‚
    ```bash
    git switch main
    git merge feature
    ```

## Rebase çš„é»ƒé‡‘æ³•å‰‡ ğŸ“œ

> **ğŸš¨ çµ•å°ä¸è¦å°å·²ç¶“æ¨é€åˆ°é ç«¯ã€ä¸”åœ˜éšŠæˆå“¡éƒ½åœ¨ä½¿ç”¨çš„å…¬é–‹åˆ†æ”¯ (ä¾‹å¦‚ `main`, `develop`) é€²è¡Œ `rebase`ã€‚**

`Rebase` åªæ‡‰è©²ç”¨åœ¨æ‚¨è‡ªå·±çš„ã€é‚„æ²’æœ‰åˆ†äº«å‡ºå»çš„ **æœ¬åœ°åˆ†æ”¯** ä¸Šï¼Œç”¨ä¾†æ•´ç†æ‚¨è‡ªå·±çš„æäº¤ã€‚

---

## ğŸ’ª å‹•æ‰‹åšï¼šç”¨ `rebase` æ•´ç†æ­·å²

1.  **å»ºç«‹å ´æ™¯**ï¼š
    *   å›åˆ° `main` åˆ†æ”¯ï¼Œä¸¦åœ¨ `readme.md` æ–°å¢ä¸€è¡Œ `Main branch updated.`ï¼Œç„¶å¾Œ commitã€‚
    ```bash
    cd C:\Users\User\Desktop\æ–°å¢è³‡æ–™å¤¾\git-tutorial\practice-repo
    git switch main
    # æ‰‹å‹•ä¿®æ”¹ readme.md
    git commit -am "docs: Update main branch"
    ```
    *   å»ºç«‹ `feature-rebase` åˆ†æ”¯ï¼Œä¸¦åœ¨ `hello.txt` æ–°å¢ä¸€è¡Œ `Testing rebase.`ï¼Œç„¶å¾Œ commitã€‚
    ```bash
    git switch -c feature-rebase
    # æ‰‹å‹•ä¿®æ”¹ hello.txt
    git commit -am "feat: Start feature development for rebase"
    ```

2.  **åŸ·è¡Œ `rebase`**ï¼š
    ç¾åœ¨ï¼Œ`feature-rebase` åˆ†æ”¯çš„åŸºç¤å·²ç¶“è½å¾Œæ–¼ `main` äº†ã€‚æˆ‘å€‘ä¾†æŠŠå®ƒæ¥åˆ° `main` çš„æœ€æ–°é€²åº¦ä¸Šã€‚
    ```bash
    git rebase main
    ```
    å¦‚æœé‡åˆ°è¡çªï¼Œè§£æ±ºæ–¹å¼å’Œ `merge` é¡ä¼¼ï¼Œè§£æ±ºå®Œå¾Œç”¨ `git add .`ï¼Œç„¶å¾ŒåŸ·è¡Œ `git rebase --continue`ã€‚

3.  **è§€å¯Ÿæ­·å²**ï¼š
    åŸ·è¡Œ `git log --graph --oneline --all`ï¼Œæ‚¨æœƒçœ‹åˆ°ä¸€æ¢å®Œç¾çš„ç›´ç·šï¼

4.  **å®Œæˆåˆä½µ**ï¼š
    ```bash
    git switch main
    git merge feature-rebase
    ```
    æ‚¨æœƒçœ‹åˆ° `Fast-forward` çš„è¨Šæ¯ï¼Œåˆä½µå®Œæˆï¼Œæ­·å²ä¾ç„¶ä¹¾æ·¨ã€‚âœ¨

---

## ä¸‹ä¸€æ­¥

`rebase` æœ€å¼·å¤§çš„åœ°æ–¹åœ¨æ–¼å®ƒçš„ã€Œäº’å‹•æ¨¡å¼ã€ã€‚åœ¨ä¸‹ä¸€å€‹ç« ç¯€ `08-Interactive-Rebase.md`ï¼Œæˆ‘å€‘å°‡å­¸ç¿’å¦‚ä½•åˆ©ç”¨äº’å‹•å¼è®ŠåŸºä¾†ç·¨è¼¯ã€åˆä½µã€é‡æ–°æ’åºæ‚¨çš„æäº¤ï¼Œè®“æ‚¨çš„æäº¤æ­·å²è®Šå¾—ç„¡æ‡ˆå¯æ“Šã€‚
